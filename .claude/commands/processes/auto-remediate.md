# Automatic Remediation

The purpose of this command is to automate remediation of security
vulnerabilities found by Snyk.

## Variables:

- `$limit`
    - Value: $ARGUMENTS
    - Purpose: Specifies the number of remediations to perform.
- `$jsonOutputFile`
    - Value: `snyk-code-report.json`
    - Purpose: A JSON formatted report generated by Snyk that enumerates
      discovered security issues.
- `$taskList`
    - Value: 'remediation-task-list.md`
    - Purpose: A markdown formatted task list that holds a list of all
      remediations performed by this command.

## Prerequisites

- We need a JSON formatted report from Snyk, generated by the command
  `snyk code test --json-file-output="$jsonOutputFile"`. If one does not
  exist then:
    - Attempt to run the command to create it.
    - If that fails, stop and notify so developer can generate it manually.
- We need to be able to communicate with Jira to create tickets. If you
  cannot read the Jira board then do not continue.

## Process

1. Learn about the structure of the Snyk JSON report so you can identify
   individual security issues surfaced in the report.
2. For each vulerability in the report:
    1. Check open PR list to see if any open PR's touch the file that
       needs to be remediated. If they do, skip this remediation and
    2. Add this remediation to the task list in `$taskList`. Do not mark
       it as complete.
    3. Create a Jira ticket for this effort. The Jira ticket's title
       should be `Remediate <vulnerability type> in $filename` where
       <vulnerability type> is the type of vulnerability detected by
       Snyk and `$filename` is the path to the file being remediated.
    4. Create a new branch. The branch name should start with the new
       Jira ticket id (CCP-XXXX) plus a description that is a valid
       git branch name.
    5. Remediate the issue. If there are additional issues detected by
       Snyk in this file, remediate them as well.
    6. Run all quality test commands. Iterate until all quality commands
       pass.
    7. Stage, commit, and push the work.
    8. Update the Jira issue with a test plan.
    9. Create a PR for the work with a good description of what was done.
       Make sure the PR comment includes the ticket ID by including a
       section called "Related Issues" and saying "Completes CCP-XXXX"
       where that is the ticket id. The PR description does not need
       to announce that Claude was involved.

-  
